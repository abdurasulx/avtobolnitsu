{% extends 'reception/base.html' %}
{% block title %}–ü–∞—Ü–∏–µ–Ω—Ç—ã{% endblock %}
{% block header %}–ü–∞—Ü–∏–µ–Ω—Ç—ã{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h4 class="fw-semibold text-primary">–°–ø–∏—Å–æ–∫ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤</h4>
  <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addPatientModal">‚ûï –ù–æ–≤—ã–π –ø–∞—Ü–∏–µ–Ω—Ç</button>
</div>

<table class="table table-bordered table-striped align-middle">
  <thead class="table-light">
    <tr>
      <th>#</th>
<th>–ò–º—è</th>
<th>–§–∞–º–∏–ª–∏—è</th>
<th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
<th>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</th>
<th>–î–µ–π—Å—Ç–≤–∏—è</th>
    </tr>
  </thead>
  <tbody>
    {% for p in patients %}
    <tr>
      <td>{{ forloop.counter }}</td>
      <td>{{ p.first_name }}</td>
      <td>{{ p.last_name }}</td>
      <td>{{ p.phone }}</td>
      <td>{{ p.birth_date|date:"d.m.Y" }}</td>
      <td>
        <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#editPatientModal{{ p.id }}">‚úèÔ∏è</button>
        
      </td>
    </tr>

    <!-- Edit modal -->
    <div class="modal fade" id="editPatientModal{{ p.id }}" tabindex="-1" aria-labelledby="editPatientLabel{{ p.id }}" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <form method="post" action="{% url 'edit_reception_patient' p.id %}">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title" id="editPatientLabel{{ p.id }}">üßç‚Äç‚ôÇÔ∏è–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–∞—Ü–∏–µ–Ω—Ç–µ</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Yopish"></button>
        </div>

        <div class="modal-body">
          <div class="row g-2">
            <div class="col-md-6">
              <label class="form-label">–ò–º—è</label>
              <input type="text" class="form-control" name="first_name" value="{{ p.first_name }}" placeholder="Ism" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">–§–∞–º–∏–ª–∏—è</label>
              <input type="text" class="form-control" name="last_name" value="{{ p.last_name }}" placeholder="Familiya" required>
            </div>

            <div class="col-md-6">
              <label class="form-label">–ü–æ–ª</label>
              <select class="form-select" name="gender">
                <option value="M" {% if p.gender == "M" %}selected{% endif %}>Erkak</option>
                <option value="F" {% if p.gender == "F" %}selected{% endif %}>Ayol</option>
              </select>
            </div>

            <div class="col-md-6">
              <label class="form-label">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
              <input type="date" class="form-control" name="birth_date" value="{{ p.birth_date|date:'Y-m-d' }}" required>
            </div>

            <div class="col-md-6">
              <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
              <input type="text" class="form-control" name="phone" value="{{ p.phone }}" placeholder="+7 (495) 539-55-19">
            </div>

            <div class="col-md-6">
              <label class="form-label">–ù–æ–º–µ—Ä —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏</label>
              <input type="text" class="form-control" name="insurance_number" value="{{ p.insurance_number }}" placeholder="XXXXXXXXX">
            </div>

            <div class="col-12">
              <label class="form-label">–ê–¥—Ä–µ—Å</label>
              <input type="text" class="form-control" name="address" value="{{ p.address }}" placeholder="Manzil">
            </div>

            <div class="col-12">
              <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
              <input type="text" class="form-control" name="plain_password" value="{{ p.plain_password }}" placeholder="Parol">
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
        </div>
      </form>
    </div>
  </div>
</div>

    {% endfor %}
  </tbody>
</table>

<!-- Add Patient Modal -->
<div class="modal fade" id="addPatientModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="post" action="{% url 'add_patient' %}">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          {% for field in form %}
            <div class="mb-3">
              <label class="form-label">{{ field.label }}</label>
              {{ field }}
              {% if field.errors %}
                <div class="text-danger small">{{ field.errors|striptags }}</div>
              {% endif %}
            </div>
          {% endfor %}
        </div>

        <div class="modal-footer">
          <button type="submit" class="btn btn-success">–î–æ–±–∞–≤–∏—Ç—å</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
