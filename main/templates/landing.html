{% load static %}
<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title> –Æ–≥–æ—Ä—Å–∫–∞—è –≥–æ—Ä–æ–¥—Å–∫–∞—è –±–æ–ª—å–Ω–∏—Ü–∞</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Inline CSS (Google Health / MedCare uslubi, oq & ko'k ranglar) -->
  <style>
    :root{
      --brand-blue: #0b6efd; /* primary */
      --brand-blue-600: #0a58ca;
      --muted: #6c757d;
      --card-radius: 14px;
      --glass: rgba(255,255,255,0.85);
    }
    body{
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg, #f8fbff 0%, #ffffff 60%);
      color: #1f2937;
    }
    .navbar{
      background: var(--glass);
      backdrop-filter: blur(6px);
    }
    .brand {
      font-weight: 700;
      color: var(--brand-blue);
      font-size: 1.15rem;
      letter-spacing: .2px;
    }

    /* Hero */
    .hero {
      padding: 5.5rem 0 4rem;
      background:
        linear-gradient(180deg, rgba(11,110,253,0.06), rgba(11,110,253,0.02));
    }
    .hero .lead {
      color: #334155;
    }
    .hero-ill {
      background: url("{% static 'images/hero.jpg' %}") center/cover no-repeat;
      min-height: 280px;
      border-radius: 12px;
      box-shadow: 0 8px 30px rgba(11,110,253,0.06);
    }

    /* Cards */
    .doctor-card img {
      height: 220px;
      object-fit: cover;
      border-top-left-radius: 12px;
      border-top-right-radius: 12px;
    }
    .doctor-card .card-body {
      padding: 1rem;
    }
    .card-custom {
      border-radius: var(--card-radius);
      box-shadow: 0 6px 20px rgba(16,24,40,0.06);
      border: 0;
    }

    /* Visits table */
    .table thead th {
      border-bottom: 0;
    }
    .badge-inprogress { background: #fff3cd; color: #856404; }
    .badge-ended { background: #d1e7dd; color: #0f5132; }

    /* Appointment form */
    .appointment {
      border-radius: 12px;
      box-shadow: 0 6px 30px rgba(2,6,23,0.04);
      background: white;
      padding: 1.25rem;
    }

    footer {
      background: linear-gradient(0deg, rgba(11,110,253,0.04), transparent);
      padding: 2rem 0;
      margin-top: 2rem;
    }

    /* Responsive tweaks */
    @media (max-width: 767.98px){
      .hero { padding: 3.5rem 0 2rem; }
      .doctor-card img { height: 180px; }
    }
  </style>
</head>
<body>

  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg py-3 sticky-top">
    <div class="container">
      <a class="navbar-brand brand" href="#">üè• –Æ–≥–æ—Ä—Å–∫–∞—è –≥–æ—Ä–æ–¥—Å–∫–∞—è –±–æ–ª—å–Ω–∏—Ü–∞</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMain">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navMain">
        <ul class="navbar-nav ms-auto align-items-lg-center">
          
          <li class="nav-item"><a class="nav-link" href="#about">–û –Ω–∞—Å</a></li>
          <li class="nav-item"><a class="nav-link" href="#doctors">–í—Ä–∞—á–∏</a></li>
          <li class="nav-item"><a class="nav-link" href="#visits">–°–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ –≤–∏–∑–∏—Ç—ã</a></li>
          <li class="nav-item"><a class="nav-link " href="#appointment">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–∏–µ–º</a></li>
          <li>  <a href="{% url 'login' %}" class="btn btn-outline-primary">Login</a> </li>

        </ul>
      </div>
    </div>
  </nav>

  <!-- HERO -->
  <section class="hero">
    <div class="container">
      <div class="row align-items-center g-4">
        <div class="col-lg-6">
          <h1 class="display-6 fw-bold">–î–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∞–º</h1>
          <p class="lead my-3">–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞, –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤—Ä–∞—á–∏ –∏ —É–¥–æ–±–Ω–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ ‚Äî –≤—Å–µ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ. –ë—ã—Å—Ç—Ä–∞—è –∏ –ø—Ä–æ—Å—Ç–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏–ª–∏ –∑–∞–ø–∏—Å—å –Ω–∞ –ø—Ä–∏–µ–º.</p>
          <div class="d-flex gap-2">
            <a href="#appointment" class="btn btn-primary btn-lg">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–∏–µ–º</a>
            <a href="#doctors" class="btn btn-outline-primary btn-lg">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Ä–∞—á–µ–π</a>
          </div>
          <ul class="list-unstyled mt-4 text-muted small">
            <li>üìç —É–ª–∏—Ü–∞ –ü–æ–ø–æ–≤–∞, 29/1, –Æ–≥–æ—Ä—Å–∫, –•–∞–Ω—Ç—ã-–ú–∞–Ω—Å–∏–π—Å–∫–∏–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥, –†–æ—Å—Å–∏—è, 628260</li>
            <li>‚è∞ –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫‚Äî–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ, 08:00‚Äî22:00</li>
            <li>üìû +7 346 752-11-12</li>
          </ul>
        </div>
        <div class="col-lg-6">
          <div class="hero-ill card-custom"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- ABOUT -->
  <section id="about" class="py-5">
    <div class="container">
      <div class="row g-4 align-items-center">
        <div class="col-md-7">
          <div class="card card-custom p-4">
            <h3 class="mb-2">–û –Ω–∞—Å</h3>
            <p class="text-muted mb-3">–Æ–≥–æ—Ä—Å–∫–∞—è –≥–æ—Ä–æ–¥—Å–∫–∞—è –±–æ–ª—å–Ω–∏—Ü–∞–ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –≤—Å–µ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ —É—Å–ª—É–≥–∏ –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ –∏ –ª–µ—á–µ–Ω–∏—é. –£ –Ω–∞—Å –µ—Å—Ç—å –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤—Ä–∞—á–∏, —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –∏ —É–¥–æ–±–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤.</p>
            <div class="row text-center">
              <div class="col-4">
                <h5 class="mb-0">24/7</h5>
                <small class="text-muted">–ü—Ä–∏–µ–º</small>
              </div>
              <div class="col-4">
                <h5 class="mb-0">+50</h5>
                <small class="text-muted">–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤</small>
              </div>
              <div class="col-4">
                <h5 class="mb-0">–ë–µ–∑–æ–ø–∞—Å–Ω–æ</h5>
                <small class="text-muted">–°–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–æ</small>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick actions -->
        <div class="col-md-5">
          <div class="card card-custom p-3 appointment">
            <h5 class="mb-3">–ë—ã—Å—Ç—Ä—ã–µ —É—Å–ª—É–≥–∏</h5>
            <div class="d-grid gap-2">
              <a href="#appointment" class="btn btn-outline-primary" style="color: black; ">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–∏–µ–º</a>
              <a href="#doctors" class="btn btn-outline-primary">–°–ø–∏—Å–æ–∫ –≤—Ä–∞—á–µ–π</a>
              <a href="#" class="btn btn-outline-primary">–ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –º–∞—Ä—à—Ä—É—Ç</a>

            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- DOCTORS -->
  <section id="doctors" class="py-5 bg-light">
    <div class="container">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="mb-0">–ù–∞—à–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã</h3>
        <p class="text-muted small mb-0">–ö–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤—Ä–∞—á–∏ ‚Äî –Ω–∞–∏–ª—É—á—à–∏–π —É—Ö–æ–¥ –¥–ª—è –≤–∞—à–µ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞</p>
      </div>

      <div class="row g-4">
        {% for doctor in doctors %}
        <div class="col-sm-6 col-md-4 col-lg-3">
          <div class="card card-custom doctor-card h-100">
            {% if doctor.img %}
            <img src="{{ doctor.img.url }}" class="card-img-top" alt="{{ doctor.user.get_full_name }}">
            {% else %}
            <img src="{% static 'images/doctor-placeholder.jpg' %}" class="card-img-top" alt="doctor">
            {% endif %}
            <div class="card-body">
              <h5 class="card-title mb-1">{{ doctor.user.get_full_name }}</h5>
              <p class="text-primary small mb-2">{{ doctor.specialty }}</p>
              <p class="text-muted small mb-3">{{ doctor.detail|default:"–ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –æ–ø—ã—Ç–µ –∏ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏."|truncatechars:80 }}</p>
              <div class="d-flex justify-content-between align-items-center">
                <small class="text-muted">–û—Ç–¥–µ–ª–µ–Ω–∏–µ: {% if doctor.department %}
    {{ doctor.department.name }}
  {% else %}
    -
  {% endif %}</small>
                <a href="#appointment" class="btn btn-sm btn-primary">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–∏–µ–º</a>
              </div>
            </div>
          </div>
        </div>
        {% empty %}
        <div class="col-12">
          <div class="card card-custom p-4 text-center">
            <p class="mb-0 text-muted">–ü–æ–∫–∞ —Å–ø–∏—Å–æ–∫ –≤—Ä–∞—á–µ–π –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.</p>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </section>

  <!-- VISITS -->
  <section id="visits" class="py-5">
    <div class="container">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="mb-0">–°–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ –≤–∏–∑–∏—Ç—ã</h3>
        <small class="text-muted">–î–∞—Ç–∞: {{ timezone.now|date:"d.m.Y" }}</small>
      </div>

      <div class="card card-custom p-3">
        <div class="table-responsive">
          <table class="table align-middle mb-0">
            <thead class="bg-white">
              <tr>
                <th scope="col">#</th>
                <th scope="col">–ü–∞—Ü–∏–µ–Ω—Ç</th>
                <th scope="col">–í—Ä–∞—á</th>
                <th scope="col">–í—Ä–µ–º—è</th>
                <th scope="col">–°—Ç–∞—Ç—É—Å</th>
              </tr>
            </thead>
            <tbody>
              {% if visits %}
                {% for visit in visits %}
                <tr>
                  <td>{{ forloop.counter }}</td>
                  <td>{{ visit.patient.first_name }} {{ visit.patient.last_name }}</td>
                  <td>{% if visit.doctor %}
  {{ visit.doctor.user.get_full_name }}
{% else %}
  ‚Äî
{% endif %}
</td>
                  <td>{{ visit.visit_datetime|time:"H:i" }}</td>
                  <td>
                    {% if visit.status == 'in_progress' %}
                      <span class="badge badge-inprogress px-2 py-1 rounded">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</span>
                    {% else %}
                      <span class="badge badge-ended px-2 py-1 rounded">–ó–∞–≤–µ—Ä—à–µ–Ω</span>
                    {% endif %}
                  </td>
                </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td colspan="5" class="text-center text-muted py-4">–°–µ–≥–æ–¥–Ω—è –≤–∏–∑–∏—Ç–æ–≤ –Ω–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ.</td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

  <!-- APPOINTMENT FORM -->
  <section id="appointment" class="py-5 bg-light">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-7">
          <div class="appointment card-custom p-4">
            <h4 class="mb-3">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–∏–µ–º</h4>
            <p class="text-muted small">–í—ã –º–æ–∂–µ—Ç–µ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–∏–µ–º –±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏.</p>

            <form id="visitForm" method="POST" action="{% url 'create_visit' %}">
              {% csrf_token %}
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label small">–ò–º—è</label>
                  <input name="first_name" type="text" class="form-control" required>
                </div>
                <div class="col-md-6">
                  <label class="form-label small">–§–∞–º–∏–ª–∏—è</label>
                  <input name="last_name" type="text" class="form-control" required>
                </div>
                <div class="col-md-6">
                  <label class="form-label small">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                  <input name="phone" type="tel" class="form-control" placeholder="+7495-539-55-19" required>
                </div>
                <div class="col-md-6">
                  <label class="form-label small">–í—Ä–∞—á (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                  <select name="doctor" class="form-select">
                    <option value="" selected>–õ—é–±–æ–π</option>
                    {% for doctor in doctors %}
                      <option value="{{ doctor.id }}">{{ doctor.user.get_full_name }} ‚Äî {{ doctor.specialty }}</option>
                    {% endfor %}
                  </select>
                </div>

                <div class="col-12">
                  <label class="form-label small">–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                  <textarea name="diagnosis" class="form-control" rows="2" placeholder="–û–ø–∏—à–∏—Ç–µ —Å–∏–º–ø—Ç–æ–º—ã..."></textarea>
                </div>

                <div class="col-12 d-grid">
                  <button type="submit" class="btn btn-primary btn-lg">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
                </div>
              </div>
            </form>

            <div id="formAlert" class="mt-3 d-none">
              <div class="alert alert-success mb-0">–°–ø–∞—Å–∏–±–æ! –ó–∞–ø–∏—Å—å —Å–æ–∑–¥–∞–Ω–∞. –ú—ã —Å–∫–æ—Ä–æ —Å–≤—è–∂–µ–º—Å—è.</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="text-center">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-8 text-md-start">
          <p class="mb-0">&copy; {{ timezone.now|date:"Y" }} –®–ò–§–û –ö–õ–ò–ù–ò–ö–ê. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
          <small class="text-muted">–ê–¥—Ä–µ—Å: –¢–∞—à–∫–µ–Ω—Ç, —É–ª. –ú–∏—Å–æ–ª, 12 ‚Äî +998 (90) 123-45-67</small>
        </div>
        <div class="col-md-4 text-md-end">
          <a class="btn btn-sm btn-outline-primary me-2" href="#">–ö–æ–Ω—Ç–∞–∫—Ç</a>
          <a class="btn btn-sm btn-outline-primary" href="#">–£—Å–ª—É–≥–∏</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Bootstrap JS bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Inline JS -->
  <script>
    (function(){
      const form = document.getElementById('visitForm');
      const formAlert = document.getElementById('formAlert');

      // Client-side simple validation / UX
      form.addEventListener('submit', function(e){
        // allow normal POST to backend (Django) to create visit.
        // But provide nicer UX: show temporary success and disable button to avoid double-submit.
        const btn = form.querySelector('button[type="submit"]');
        btn.disabled = true;
        btn.innerHTML = '–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è...';

        // Let the browser submit ‚Äî but show success after a short delay only if form posts via fetch isn't used.
        // If backend redirects, this won't run; the UX below is best-effort for progressive enhancement.
        setTimeout(function(){
          // If page still present (no redirect), show alert and re-enable
          if (document.body.contains(form)) {
            formAlert.classList.remove('d-none');
            btn.disabled = false;
            btn.innerHTML = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å';
            form.reset();
          }
        }, 1200);
      });

      // smooth scroll for anchor links
      document.querySelectorAll('a[href^="#"]').forEach(function(a){
        a.addEventListener('click', function(e){
          const target = document.querySelector(this.getAttribute('href'));
          if (target) {
            e.preventDefault();
            target.scrollIntoView({behavior:'smooth', block:'start'});
          }
        });
      });
    })();
  </script>
</body>
</html>