{% extends 'base.html' %}

{% block content %}
<h2>Список приемов</h2>
<a href="{% url 'visit_add' %}" class="btn">Новый прием</a>
<a href="{{ export_url }}" class="btn">Экспорт CSV</a>
<table>
    <thead>
        <tr><th>ID</th><th>Пациент</th><th>Врач</th><th>Дата</th> <th>Статус</th> <th>Результат</th> <th>Действия</th></tr>
    </thead>
    <tbody>
        {% for visit in visits %}
        <tr>
            <td>{{ visit.id }}</td>
            <td>{{ visit.patient }}</td>
            <td>{{ visit.doctor }}</td>
            <td>{{ visit.visit_datetime|date:"d.m.Y H:i" }}</td>
            <td>
                <span class="badge {% if visit.status == "ended" %}bg-success{% elif visit.status == "in_progress" %}bg-warning text-dark{% else %}bg-secondary{% endif %}">{% if visit.status == "ended" %}Завершен{% elif visit.status == "in_progress" %}В процессе{% else %}Ожидает{% endif %}</span>
            </td>
            <td>  {% if visit.result == "in_progress" %} <span class="badge bg-secondary">В процессе</span> {% elif visit.result == "none" %}  <span class="badge bg-secondary">Нет результата</span> {% elif visit.result == "home"  %} <span class="badge bg-success">На дому</span>  {% elif visit.result == "hospital" %} <span class="badge bg-success">Даволен в больнице (палата)</span> {% endif %}</td>
            <td>
                <a href="{% url 'visit_edit' visit.pk %}">Редактировать</a>
                <a href="{% url 'visit_delete' visit.pk %}" onclick="return confirm('Удалить?')">Удалить</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}