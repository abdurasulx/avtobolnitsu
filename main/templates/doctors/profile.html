{% extends 'dbase.html' %}
{% load static %}
{% block content %}
<div class="container-fluid mt-4 px-3 px-md-4">
  <h2 class="fw-bold text-primary mb-4">Мой профиль</h2>

  <!-- Profile Information (Readonly) -->
  <div class="card shadow-sm rounded-3 mb-4">
    <div class="card-header bg-light">
      <h5 class="mb-0 fw-semibold">Персональные данные</h5>
    </div>
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label fw-bold">Полное имя</label>
          <p class="form-control-plaintext">{{ user.get_full_name|default:"Не указано" }}</p>
        </div>
        <div class="col-md-6">
          <label class="form-label fw-bold">Email</label>
          <p class="form-control-plaintext">{{ user.email|default:"Не указан" }}</p>
        </div>
        <div class="col-md-6">
          <label class="form-label fw-bold">Специальность</label>
          <p class="form-control-plaintext">{{ doctor.specialty|default:"Не указана" }}</p>
        </div>
        <div class="col-md-6">
          <label class="form-label fw-bold">Отделение</label>
          <p class="form-control-plaintext">{{ doctor.department|default:"Не указано" }}</p>
        </div>
        {% if doctor.detail %}
        <div class="col-12">
          <label class="form-label fw-bold">О себе</label>
          <p class="form-control-plaintext">{{ doctor.detail }}</p>
        </div>
        {% endif %}
        {% if doctor.img %}
        <div class="col-12">
          <label class="form-label fw-bold">Фото</label>
          <img src="{{ doctor.img.url }}" alt="Фото доктора" class="rounded-circle" style="width: 100px; height: 100px; object-fit: cover;">
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Password Change Form -->
  <div class="card shadow-sm rounded-3 mb-4">
    <div class="card-header bg-light">
      <h5 class="mb-0 fw-semibold">Смена пароля</h5>
    </div>
    <div class="card-body">
      <form method="post" id="password-form">
        {% csrf_token %}
        <div class="mb-3">
          <label for="{{ password_form.new_password1.id_for_label }}" class="form-label">Новый пароль</label>
          <input type="password" name="new_password1" placeholder="Введите новый пароль" class="form-control" id="{{ password_form.new_password1.id_for_label }}" >
          {% if password_form.new_password1.errors %}
            <div class="text-danger small">{{ password_form.new_password1.errors }}</div>
          {% endif %}
        </div>
        <div class="mb-3">
          <label for="{{ password_form.new_password2.id_for_label }}" class="form-label">Подтверждение нового пароля</label>
          <input type="password" name="new_password2" placeholder="Подтвердите новый пароль" class="form-control" id="{{ password_form.new_password2.id_for_label }}" >
          {% if password_form.new_password2.errors %}
            <div class="text-danger small">{{ password_form.new_password2.errors }}</div>
          {% endif %}
        </div>
        <button type="submit" class="btn btn-primary">Сменить пароль</button>
        <a href="{% url 'dashboard' %}" class="btn btn-secondary ms-2">Отмена</a>
      </form>
    </div>
  </div>
</div>

<style>
@media (max-width: 768px) {
  .container-fluid {
    padding-left: 1rem;
    padding-right: 1rem;
  }
  .row.g-3 > div {
    margin-bottom: 1rem;
  }
  .btn {
    width: 100%;
    margin-top: 0.5rem;
  }
  .ms-2 {
    margin-left: 0 !important;
  }
}

.form-control, .form-select {
  border-radius: 8px;
}
.form-control-plaintext {
  padding: 0.375rem 0.75rem;
  background-color: #f8f9fa;
  border: 1px solid #dee2e6;
  border-radius: 0.375rem;
}
</style>

<script>
document.getElementById('password-form').addEventListener('submit', function(e) {
  const pw1 = document.querySelector('input[name="new_password1"]').value;
  const pw2 = document.querySelector('input[name="new_password2"]').value;
  if (pw1 !== pw2) {
    e.preventDefault();
    alert('Пароли не совпадают!');
  }
});
</script>
{% endblock %}
